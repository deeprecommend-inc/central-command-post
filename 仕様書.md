SNS運用オーケストレーター 仕様書
1. 目的
目的：YouTube／X／Instagram／TikTok運用を単一UIで統合。OAuth接続済みの自社／同意済みアカウントに対し、予約・返信支援・分析・監査を提供。アカウント自動生成、成りすまし、検知回避、CAPTCHA回避、クリック水増し、規約違反。


2. 適用範囲
PF：YouTube Data API v3、X API v2、Instagram Graph API、TikTok Business API


操作：投稿予約、返信候補生成→人手承認必須、いいね、フォロー（審査済み対象のみ）


地域：Asia/Tokyoを既定。多言語は将来拡張。


3. 基本方針
原則公式API。


自動処理は承認フローで制御。


全操作の監査ログ（WORM）。


レート遵守＋自動スロットリング。


“Bot検知で使われる特徴”はパラメータ化。
プロキシローテーションはhttps://brightdata.jp/のAPIを使用。
指紋ブラウザはhttps://www.mulogin.com/のAPIを使用。


4. 画面仕様（モノトーン、ミニマル）
4.1 画面群
ダッシュボード：KPIカード、当日キュー、承認待ち。


実行作成：PF選択→フォーム出現→最後にCustom Prompt→実行。


承認キュー：AI案の承認／差戻し／編集。


OAuth接続：PFごとの状態表示、再認可。


キャンペーン：期間・目標・対象投稿束。


監視：観測メトリクスとアラート、Kill Switch。


エクスポート：CSV/JSON。


4.2 共通フォーム
PF選択：YouTube／X／Instagram／TikTok


実行エンジン：


API Fast（推奨）＝公式API実行


Browser QA（限定）＝自社所有ドメインのUI検証用途のみ


スケジュール：開始／終了／TZ／繰り返し


レート・ペース：1h上限／Daily上限／並列数／待機[min–max秒・分布（Uniform/Normal）]


承認：返信系は承認必須（既定ON）。


Custom Prompt：最下段テキスト。安全フィルタ通過必須。


監視しきい値：後述「16分類観測」をPF横断で設定。


4.3 PF別追加
YouTube：動画/Shorts、公開範囲、タグ、コミュニティ投稿、コメント方針。


X：ポスト／スレッド／引用、メンション管理、メディア添付。


Instagram：フィード／リール、ロケーション、タグ、返信方針。


TikTok：動画、字幕、利用可能サウンド（権利範囲内）。


5. AI生成（プロンプト統合）
入力：フォーム値（KPI、レート、クールダウン、NG辞書、重複率）＋Custom Prompt。


出力：返信候補N件、投稿案、ハッシュタグ案、配信スケジュール案。


形式：JSON（drafts[], schedule[], policy[]）。


ルール：安全ポリシーは上書き不可。NG語／重複率／連投制限を必ず適用。


6. 監視しきい値（16分類マッピング）
観測しきい値をweb formで設定可能にする。
IP構造：IP×UA整合σ、地域不一致%、ASN偏り%、住宅/モバイル比率下限。


通信リズム：等間隔スコア、継続接続比率、同一IP同時実行上限。


暗号/プロトコル：JA3/TLS不一致%、HTTP/2/3異常%。


UA：実在しないUA検出%、IP単位UA多様性下限。


指紋：Canvas/WebGLドリフトσ、解像度×UA不一致%、OS×ブラウザ整合スコア、フォント/プラグイン存在率。


Cookie/保存：Cookie初期化発生%、LocalStorage失敗%。


JS動作：JSエラー%、DOMイベントエントロピー下限。


マウス/クリック：曲線要素%、操作前ウェイトms、微小ゆらぎフラグ。


テンポ：人間反応ウィンドウms、滞在時間変動%。


ナビゲーション：Referrer整合スコア、戻る/進む最小比率%。


ヘッダ：ヘッダ順序不一致%、Origin/Referer不整合%、圧縮ネゴ失敗%。


データ送信：hidden欠落%、APIバースト%。


CAPTCHA後挙動：早すぎるクリック警告ms。


一貫性：IP/UA/Cookie整合スコア、時計ずれ最大秒。


分散：開始時刻分散±分、同時刻スパイク比率%。


自動学習対応：ルール変化観測窓min、超過時挙動（alert/slowdown/freeze/abort）。



8. アーキテクチャ
[React/Next] ─REST→ [FastAPI] ─→ [Redis(Queue+Rate)]
                           │
                         [Workers(Python)]
                           │
               [SNS API / Internal QA Domain]
                           │
          [PostgreSQL] + [WORM Audit Storage]

UI：React（Next.js, Tailwind, Shadcn）


API：FastAPI（OAuth中継、バリデーション）


Queue/Rate：Redis（トークンバケツ＋並列ロック）


Worker：Python（API Fast／Browser QA）


DB：PostgreSQL＋WORM監査（不可逆）


モニタ：成功率、429/403、平均レイテンシ、周期性スコア。


9. データモデル（主テーブル）
accounts(id, platform, oauth_token_ref, owner_user_id, status)


runs(id, platform, engine, schedule_json, observability_json, prompt_json, status)


run_events(id, run_id, action, started_at, ended_at, response_code, detail)


ai_drafts(id, run_id, outputs_json, toxicity, duplication_rate)


kpi_snapshots(id, platform, range, metrics_json)


audit_worm(id, timestamp, actor_user_id, operation, payload_immutable)


10. API（自社バックエンド例）
POST /oauth/{platform}/connect、GET /oauth/{platform}/status


POST /ai/generate（フォーム→プロンプト→案生成）


POST /schedules / PATCH /schedules/{id}


POST /drafts/{id}/approve → POST /execute


GET /metrics/kpi?platform=...&range=...


GET /exports?type=csv|json&range=...


11. 実行フロー（ワーカー）
Run登録→スケジューラがJob分割→キュー投入。


レートリミット確認（PF×アクション×時間／日）。


監視ガード（16分類しきい値）→スローダウン／停止判定。


アダプタ実行（API）。


結果記録→KPI反映→監査WORM追記。


しきい値超過は通知＋自動制御。


13. OAuth（Online）
UI→/oauth/{pf}/connect→同意→callback。


トークンはKMS封筒方式。生保管禁止。


失効検出→再同意誘導。


14. バリデーション
PF公表レート超過は保存不可。


ProductionでBrowser QA専用項目は非表示。


Custom PromptはNG辞書／トーン規約に抵触で弾く。


16. 非機能
SLO 99.9%。


1万ジョブ／日スケール。


DLQ（恒常失敗隔離）。


全ジョブにKill Switch。


17. テスト計画
アダプタ統合、レート異常（429集中）、観測ガード（周期性・遅延シンセ）、フォームE2E、監査不可逆性、権限分離。


18. リスクと対策
誤投稿：承認必須、クールダウン、即停止。


レート超過：強制スロットル、バックオフ。


炎上：NG辞書、トーン規約、緊急停止。


規約変更：アダプタ層のバージョン固定＋回帰テスト。


19. ロードマップ
v1.3：本仕様。


v1.4：PF別レート自動同調、A/Bプロンプト、学習辞書。


v1.5：チーム運用強化（多段承認、SLA監視、当直ルール）。


20. 付録A：16分類→観測キー完全対応表
分類
キー名
型
既定
超過時
1 IP構造
ip_ua_inconsistency_sigma
float
2.5
slow→freeze→abort


geo_mismatch_pct
%
5
alert→slow


asn_bias_pct
%
60
alert


residential_ratio_min
%
30
alert
2 リズム
interval_periodicity_score
0-100
75
slow


persistent_conn_ratio_min
%
40
alert


simul_conn_per_ip_max
int
4
block新規
3 暗号
tls_ja3_mismatch_pct
%
3
alert


proto_error_rate_pct
%
2
alert
4 UA
ua_nonexistent_pct
%
1
abort調査


ua_per_ip_diversity_min
int
1
alert
5 指紋
canvas_hash_drift_sigma
float
2.0
alert


viewport_ua_mismatch_pct
%
5
alert


os_browser_consistency_score_min
0-100
80
alert


font_plugin_presence_ratio_min
%
70
alert
6 保存
cookie_reset_rate_pct
%
5
alert


localstorage_write_fail_pct
%
1
alert
7 JS
js_exec_error_pct
%
2
alert


dom_event_entropy_min
0-10
2.0
alert
8 ポインタ
pointer_curve_ratio_min
%
30
alert


pre_action_delay_ms_min
ms
150
alert


micro_jitter_enabled
bool
true
n/a
9 テンポ
human_rxn_window_ms
range
200-500
alert


page_dwell_time_var_pct
%
35
alert
10 移動
referrer_consistency_min
0-100
80
alert


nav_back_forward_ratio_min
%
5
alert
11 ヘッダ
header_order_mismatch_pct
%
2
alert


origin_referer_mismatch_pct
%
1
alert


content_encoding_error_pct
%
1
alert
12 送信
hidden_field_missing_pct
%
1
abort


burst_api_ratio_pct
%
10
slow
13 CAPTCHA
post_captcha_hurry_click_ms
ms
800
alert
14 一貫性
state_consistency_score_min
0-100
85
alert


tz_clock_drift_sec_max
sec
120
alert
15 分散
start_time_spread_minutes
min
10
alert


burst_cluster_alert_pct
%
15
slow
16 学習対応
rule_change_detect_window_min
min
30
n/a


auto_response_policy
enum
slowdown
動作切替




